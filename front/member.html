<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>Orca_Member</title>
    <style>
        .active {
            display: block;
        }

        .nonactive {
            display: none;
        }
    </style>
</head>

<body>
    <header>
        <p>image comes here...</p>
        <h1>Welcome, (member name comes here...)</h1>
        <button>Logout</button>
    </header>

    <main>
        <div>
            <h3>
                My Workout Program
            </h3>
            <div class="workout-text">
                Messages from instructor comes here...
            </div>
        </div>

        <div>
            <div class="workout">
            </div>

            <div>
                <form class="workout-form nonactive">
                    <fieldset>
                        <legend>1. Which difficulty level would you like to choose?</legend>
                        <div>
                            <input type="radio" id="beginner" name="level" value="beginner" checked />
                            <label for="beginner">Beginner</label>
                        </div>
                        <div>
                            <input type="radio" id="intermidiate" name="level" value="intermidiate" />
                            <label for="intermidiate">Intermidiate</label>
                        </div>
                        <div>
                            <input type="radio" id="advanced" name="level" value="advanced" />
                            <label for="advanced">Advanced</label>
                        </div>
                    </fieldset>

                    <label for="days">2. How many days a week would you like to workout?</label>
                    <select name="days" id="days">
                        <option value="">--Please choose an option--</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                    </select>

                    <label for="instructors">3. Which instructors would you like to work with?</label>
                    <select name="instructors" id="instructors">
                        <option value="">--Please choose an option--</option>
                        <option value="Arnold">Arnold</option>
                    </select>

                    <fieldset>
                        <legend>4. What is your goal with this program?</legend>
                        <div>
                            <input type="radio" id="burn fat" name="goal" value="burn fat" checked />
                            <label for="burn fat">Burn Fat</label>
                        </div>
                        <div>
                            <input type="radio" id="build muscle" name="goal" value="build muscle" />
                            <label for="build muscle">Build Muscle</label>
                        </div>
                        <div>
                            <input type="radio" id="gain strength" name="goal" value="gain strength" />
                            <label for="gain strength">Gain Strength</label>
                        </div>
                        <div>
                            <input type="radio" id="stay active" name="goal" value="stay active" />
                            <label for="stay active">Stay Active</label>
                        </div>
                    </fieldset>

                    <label for="note">Tell us your note:</label>
                    <textarea id="note" name="note"></textarea>
                    <button type="submit">Send</button>
                </form>
            </div>
        </div>
    </main>



    <script type="module">
        import XMLReq from "./js/XMLReq.js"
        const memberPhp = "http://localhost/php/FitnessCMS-FinalProject/members.php";
        let xmlReq = new XMLReq(memberPhp);

        let memberInfo;
        let workoutData = [];
        let workoutDiv = document.querySelector(".workout");
        let requestForm = document.querySelector(".workout-form");
        // Add event listener to form request.
        requestForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const sid = sessionStorage.getItem("sid");
            const mid = sessionStorage.getItem("mid");
            let reqData = new FormData(e.target);
            reqData.append("sid", sid);
            reqData.append("mid", mid);
            // After submitting form of workout request.
            reqData.append("status", "pending")
            reqData.append("mode", "form")
            xmlReq.Post(reqData).then(
                (data) => {
                    console.log(data);
                },
                (rej) => {
                    console.log(rej);
                }
            )

        })
        // Function making request form visible.
        const workoutRequestPopper = (e) => {
            e.preventDefault();
            requestForm.classList.remove("nonactive");
            requestForm.classList.add("active");
        }
        // Function displaying cards of workouts.
        const workoutCardPopper = () => {
            console.log(workoutData);
            let cardsField = document.createElement("div");
            cardsField.classList.add("row");
            cardsField.classList.add("row-cols-1");
            cardsField.classList.add("row-cols-md-4");
            // cardsField.classList.add("row-cols-md-4");
            cardsField.classList.add("g-2");
            workoutData.map((workout, key) => {
                let col = document.createElement("div");
                col.classList.add("col");
                let card = document.createElement("div");
                card.classList.add("card");
                card.classList.add("bg-light");
                let image = document.createElement("img");
                image.classList.add("card-img-top");
                image.src = `${workout.title}`;
                image.alt = `Image of ${workout.wname}`
                let title = document.createElement("p");
                title.classList.add("card-title");
                title.textContent = workout.wname;
                let target = document.createElement("p");
                target.classList.add("card-text");
                target.textContent = workout.target;
                let type = document.createElement("p");
                type.textContent = workout.type;
                let sets = document.createElement("p");
                sets.textContent = workout.reps;
                let reps = document.createElement("p");
                reps.textContent = workout.reps;
                let targetImage = document.createElement("p");
                targetImage.textContent = workout.target;
                card.append(image, title, target, type, sets, reps, targetImage);
                col.append(card);
                cardsField.append(col);
            })
            workoutDiv.append(cardsField);
        }
        // Function producing button leading form 
        // or producing workout cards.
        const workoutHandler = () => {
            if (memberInfo.status === null) {
                workoutDiv.textContent = "haven't create program";
                let requestBtn = document.createElement("button");
                requestBtn.type = "button";
                requestBtn.textContent = "Request Wrokout";
                requestBtn.addEventListener("click", (e) => {
                    e.preventDefault();
                    workoutRequestPopper(e);
                })
                workoutDiv.append(requestBtn);
            } else {
                let reqData = new FormData();
                const mid = sessionStorage.getItem("mid");
                reqData.append("mid", mid);
                reqData.append("mode", "cards");
                xmlReq.Post(reqData).then(
                    (data) => {
                        // This data should be array.
                        workoutData = JSON.parse(data);
                        workoutCardPopper();
                    },
                    (rej) => {
                        console.log(rej);
                    }
                )
            }
        }

        const load = () => {
            const sid = sessionStorage.getItem("sid");
            const mid = sessionStorage.getItem("mid");
            let reqData = new FormData();
            reqData.append("sid", sid);
            reqData.append("mid", mid);
            reqData.append("mode", "load")
            xmlReq.Post(reqData).then(
                (data) => {
                    console.log(data);
                    memberInfo = JSON.parse(data);
                    workoutHandler();
                },
                (rej) => {
                    console.log(rej);
                }
            )
        }
        load();


        // let form = document.createElement("form");
        // let beginnerP = document.createElement("p");
        // beginnerP.textContent = "What difficulty of level of workout would you like?"
        // let beginnerLabel = document.createElement("label");
        // beginnerLabel.htmlFor = "beginner"
        // beginnerLabel.textContent = "What difficulty of level of workout would you like?"
        // let beginner = document.createElement("input");
        // beginner.id = "beginner";

        // let difOption = document.createElement("option");
        // difOption.value =

        // // input for notes
        // let notesLabel = document.createElement("label");
        // notesLabel.htmlFor = "notes"
        // notesLabel.textContent = "Extra notes for your instuctor."
        // let notesInput = document.createElement("textarea");
        // notesInput.name = "notes";
        // notesLabel.append(notesInput);

        // // putting all together
        // form.append(notesLabel);
        // workoutDiv.append(form);
    </script>
</body>



</html>